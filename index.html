<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.13.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="东的博客">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="东的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="东">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>东的博客</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="东的博客" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">东的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">东</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">8</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/02/25/Android%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%88%9B%E5%BB%BA%E8%BF%87%E7%A8%8B%E7%AE%80%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="东">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="东的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 东的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/02/25/Android%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%88%9B%E5%BB%BA%E8%BF%87%E7%A8%8B%E7%AE%80%E6%9E%90/" class="post-title-link" itemprop="url">Android虚拟机创建过程简析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-02-25 20:21:25 / 修改时间：20:30:09" itemprop="dateCreated datePublished" datetime="2024-02-25T20:21:25+08:00">2024-02-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>简要分析Android虚拟机创建过程</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/02/25/Android%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%88%9B%E5%BB%BA%E8%BF%87%E7%A8%8B%E7%AE%80%E6%9E%90/">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/05/%E5%85%B3%E4%BA%8E%E8%AF%BB%E4%B9%A6%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%9D%E8%80%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="东">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="东的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 东的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/05/%E5%85%B3%E4%BA%8E%E8%AF%BB%E4%B9%A6%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%9D%E8%80%83/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-05 17:46:00" itemprop="dateCreated datePublished" datetime="2023-05-05T17:46:00+08:00">2023-05-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-30 23:05:07" itemprop="dateModified" datetime="2023-05-30T23:05:07+08:00">2023-05-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>关于读书的一点思考</p>
<p>1.为什么要读这本书？</p>
<p>解决当前遇到的困惑，或者为以后的行动提供指导</p>
<p>2.如何读一本书？</p>
<p>了解书中的背景（一般在序中），解决方案（观点，或者结论）</p>
<p><b>一、《影响力》</b></p>
<p>背景：生活中自己容易被说服做一些自己不想做的事情，比如买自己不想买的东西；有些人说服别人很厉害。</p>
<p>问题：有哪些因素在让一个人向另外一个人说“行”？哪些技术最有效地利用了这些因素，使人们产生了顺从心理？</p>
<p>研究方法：参与式观察</p>
<p>结论：七大原则</p>
<p><b>二、《寻找内在自我：马斯洛谈幸福》</b></p>
<p>在心理学的发展中，马斯洛可以说是继弗洛伊德、荣格后的一位心理学大师。弗洛伊德抓住了潜意识从而给心理学带来了一场革命，不过“弗洛伊德将人类心理描绘成一种带有地下室的小屋，地下室中全是老鼠和腐烂的垃圾”。而马斯洛第一次清楚地阐明了人类有心理需要，包括对创造性，长远目标、价值观、善等的需要，从而创造了关于人性的一个完整视图。</p>
<p>马斯洛提出了“高峰体验”，是日常生活中的一部分。</p>
<p>马斯洛极具洞察力地提出，你是否有可能很幸福但不知道自己很幸福，答案的确是我们一直如此。当我们因为一些琐事而陷入困境的时候，如何能学会知觉到这一点呢？</p>
<p>我一直认为人的问题可以很简单地进行表述：在面对有趣或令人激动的挑战时，我们就处在自己最好的状态。每个人都憧憬着更富有创造性、更富有成效的生活方式，而当外部问题都消失的时候，我们倾向于陷入一种停滞之中。</p>
<p>因此，我们追求某种“目标”来让自己获得满足，这个目标通常都是比较复杂但又很有趣的。</p>
<p>但找到这样既能让你感兴趣又基本上像是浪费生命的事情并不容易，比如你可以没完没了地办晚宴，邀请人来参加，直到你愿意自己一个人度过一个晚上。因此，人们发现面对的是一个对自己并没有什么帮助的选择：高高兴兴地被“卷入”，但又不得不承认浪费了大量的时间，或者不被“卷入”，但又被无聊所麻痹，缺乏目标。</p>
<p>对我来说，人性已经达到了进化的临界点，当前最迫切的需求是学会如何进入一种“着迷的状态”（心理卷入）并依然保持独处或没有让自己卷入其中。赫伯特·乔治·威尔斯（H.G.Wells）曾说过：“鱼是水的产物，鸟是天空的产物，人是思想的产物。”只有我们学会按照自己的意志随意进入这些“内在”状态的方法，这种意志才是真实的，否则我们依然会被外部世界所奴役。</p>
<p>如何让自己感受到幸福：关注高峰体验，并将它们看作生活正常且必要的组成部分，这就是获得高峰体验的窍门。</p>
<p>个人体会：</p>
<p><b>为什么要给自己设定目标，因为摆脱无聊的状态，追求“高峰体验”是人性的一部分。</b></p>
<p><b>三、《福格行为模型》</b></p>
<p>准确的说这是一篇关于怎么设计行为的书，将理论转为可操作的动作。</p>
<p>1.简单才能改变行动</p>
<p>我在商业领域工作时，会观察什么行得通、什么行不通。我看到了一个共同的模式，苹果和谷歌是这样的，所有成功的人都是这样的——他们创造了一个非常简单的产品。</p>
<p>2.行为公式</p>
<p>B&#x3D;MAP，即当“动机、能力、和提示”同时发生时，行为才能发生。</p>
<p>3.掌握微习惯策略，所有人都可以改变</p>
<p><b>四、《认知心理学》</b></p>
<p>认知心理学是以信息加工为核心的心理学，又可称作信息加工心理学，主要指以信息加工观点为特征的心理学。</p>
<p><b>五、《社会心理学》</b></p>
<p>揭示社会现象的心理学，包括科学家是怎么发现和解释这些现象的，同时激发学生思考，促使他们去探索，去分析，并把这些规则同日常生活联系起来。</p>
<p><b>六、《腾讯传》</b></p>
<p>问题1:为什么是腾讯，而不是其他互联网公司，成为当今中国市值最高、用户数最多、盈利能力最强的企业？它的成功是一次战略规划的结果，还是偶然的产物？</p>
<p>问题2:为什么腾讯曾经遭遇空前的质疑，它所面临的模仿而不创新、封闭而不开放的“指控”是怎么形成的？性情温和的马化腾如何成为很多人眼中的“全民公敌”？</p>
<p>问题3:中国互联网公司和美国互联网公司有什么异同？前者的繁荣是一次长期的追随之旅，还是有自己的东方式生存之道？</p>
<p>成长四阶段理论：积累资源-&gt; 资源的合理化利用-&gt;持续增长-&gt;对扩展中的资源的合理利用</p>
<p>七种武器：</p>
<ul>
<li>产品极简主义： 少就是合适的，“Don’t make me think”</li>
<li>用户驱动战略：马化腾提出互联网公司有三种驱动力，即技术驱动、应用驱动、用户和服务驱动，腾讯将着力对于第三种能力的培养。</li>
<li>内部赛马机制</li>
<li>试错迭代机制</li>
<li>生态养成模式</li>
<li>资本整合能力</li>
<li>专注创业初心</li>
</ul>
<p><b>七、《增长黑客》</b></p>
<p>推荐序由迅雷创始人 程浩所做，其总结为<b>以有限的资源获得最大限度的成长</b>，以下为部分总结：</p>
<p>“对于如何有效获取、留存用户、让业务爆发增长，书中不仅有体系的方法论，更有翔实的实战技巧。任何希望以有限的营销资源，甚至不想额外花钱就能收获的最大限度成长的企业家，本书都不容错过”</p>
<p>肖恩·埃利斯和摩根·布朗两位作者呕心撰写的《增长黑客》，可以说正是《精益创业》的姊妹篇。</p>
<p>因为《精益创业》主要聚焦在如何低成本快速验证需求和解决方案，所以埃里克并没有针对用户增长这块着更多笔墨，毕竟“由需求”是用户增长的前提。但是精益创业显然也不是万能钥匙，特别在国内，随着人口红利和移动互联网流量红利的双双消失，商业环境已完成了从以往粗放式增长到精细化运营的转变，初创企业即使验证了需求和方案，仍然面对如何获客和如何留存问题。而《增长黑客》主要讲的就是验证需求后，如何获客、如何激活、如何留存，以及如何赚取更多利润的方法。两本书相结合，基本覆盖了整个创业过程。</p>
<p><b>八、《精益创业》</b></p>
<p><font color="#dd000000">铁匠在啤酒中洒下眼泪，悲叹自己没有办法在铁路时代卖马掌，但是这并不会使他们的马掌更受欢迎。哪些学习变成机械师的铁匠才会保住自己的饭碗。</font></p>
<p>企业唯有快速顺应时代才能赢得未来，产品生产方式必须因时代而改变</p>
<p>我们身处的商业时代有两大主题：互联网化和全球化。这个时代有几个新的特点：从市场结构来看，产品供给方的数量和质量远远超过了古典的商业时代，大多数市场是典型的买方市场，竞争激烈，企业唯有更好地满足客户需求才能生存；从消费趋势来看，用户的需求日趋多元化，满足他们需求的难度正在不断提高；从技术发展来看，以互联网、移动互联网为代表的信息技术，可以帮助企业深入理解大多数客户和消费者，按需驱动，使产品快速灵活地适应市场，同时去除无谓的损耗，企业效益得以最大化。</p>
<p>如何做？埃里克的《精益创业》作了一个优秀的提炼：目标顾客—小范围实验—反馈修改—产品迭代—获得核心认知—高速增长。</p>
<p>创业的第一阶段是把想法变成产品。这时开发的产品是精简的原型，投入最少的金钱和精力开发出体现核心价值的产品。</p>
<p>创业的第二阶段，新创企业要对正确的产品形态进行重点投入，做好做细，做“最了解用户的人”，做到极致</p>
<p>创业的第三阶段，成功者往往伴随着爆发式的增长，全面的扩张</p>
<p><b>九、小米创业思考</b></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/16/Android%E8%B5%84%E6%BA%90%E7%AE%80%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="东">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="东的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 东的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/16/Android%E8%B5%84%E6%BA%90%E7%AE%80%E6%9E%90/" class="post-title-link" itemprop="url">Android资源简析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-04-16 12:02:08" itemprop="dateCreated datePublished" datetime="2023-04-16T12:02:08+08:00">2023-04-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-02-25 20:24:20" itemprop="dateModified" datetime="2024-02-25T20:24:20+08:00">2024-02-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>这里主要是对res目录下的几个重要类的源码做解读，加载机制可以参考</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/817a787910f2">https://www.jianshu.com/p/817a787910f2</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/02a2539890dc">https://www.jianshu.com/p/02a2539890dc</a></p>
<p>觉得很不错。</p>
<p>Hex</p>
<p><b>ResourcesLoader</b></p>
<p>主要作用是添加额外的资源或者对已经存在的资源进行更改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ApkAssets[] mApkAssets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> ResourcesProvider[] mPreviousProviders;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> ResourcesProvider[] mProviders;</span><br></pre></td></tr></table></figure>

<p>包含了以上几个重要属性，同时主要提供了这几个对象的get和set，clear方法</p>
<p><b>ResourcesProvider</b></p>
<p>负责从apk或者resources table加载资源数据</p>
<p>主要是通过loadFromXXX方法从apk，table或者Directory加载数据，而loadFromXXX方法则进一步调用了ApkAssets相关方法，最终通过对应的native方法来加载资源</p>
<p><b>AssetManager</b></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/16/ActivityInfo%E6%9D%82%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="东">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="东的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 东的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/16/ActivityInfo%E6%9D%82%E8%AE%B0/" class="post-title-link" itemprop="url">ActivityInfo杂记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-04-16 10:42:13 / 修改时间：12:02:14" itemprop="dateCreated datePublished" datetime="2023-04-16T10:42:13+08:00">2023-04-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><b>ActivityInfo</b></p>
<p>提供了某个Activity或者receiver的信息，相关信息从manifest中解析而来</p>
<p><b>ApplicationInfo</b></p>
<p>解析manifest中的application标签生成，包括像taskAffinity,permission,processName等信息</p>
<p><b>Packageinfo</b></p>
<p>包的全部信息，包含了所有从manifest解析而来的内容，比如四大组件信息，签名信息，apk和splitApk名称等。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/15/DownloadManager%E7%AE%80%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="东">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="东的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 东的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/15/DownloadManager%E7%AE%80%E6%9E%90/" class="post-title-link" itemprop="url">DownloadManager简析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-04-15 16:29:19" itemprop="dateCreated datePublished" datetime="2023-04-15T16:29:19+08:00">2023-04-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-04-16 10:39:43" itemprop="dateModified" datetime="2023-04-16T10:39:43+08:00">2023-04-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>DownloadManger是用于处理长时间运行http下载的系统服务，downlaodermanager可以运行在后台，同时对失败情况进行retry处理。需要INTERNET 权限。</p>
<p>DownloadManager只是提供给开发者的一个外部调用接口，真正的具体管理要看下载服务管理</p>
<p><a target="_blank" rel="noopener" href="http://aospxref.com/android-13.0.0_r3/xref/packages/providers/DownloadProvider/">http://aospxref.com/android-13.0.0_r3/xref/packages/providers/DownloadProvider/</a></p>
<p>主要是将请求信息插入数据库，再由下载管理进行具体的下载操作，暂时就不做多分析</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/garment1991/article/details/54178557/">https://blog.csdn.net/garment1991/article/details/54178557/</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/15/ActivityManager%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="东">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="东的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 东的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/15/ActivityManager%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">ActivityManager简要分析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-04-15 15:28:23 / 修改时间：16:11:20" itemprop="dateCreated datePublished" datetime="2023-04-15T15:28:23+08:00">2023-04-15</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>ActivityManager提供了关于Activity，Service信息，大多数场景下不需要使用，但是其中也提供了几个重要的方法，比如isLowRamDevice，判读是否运行在一个低内存手机上，或者clearApplicationUserData 重置应用数据。</p>
<p>如果应用需要同Task stack打交道，也可能会用到其中的ActivityManager.AppTask和ActivityManager.RecentTaskInfo,另外还涉及到一些进程相关的api</p>
<p>ActivityManager交互的对象很多，比如像最近任务、进程、服务等等。</p>
<p><b><font color="#dd0000">Task相关</font></b></p>
<ul>
<li>获取应用的任务信息</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Get the list of tasks associated with the calling application.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> The list of tasks associated with the application making this call.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> SecurityException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> List&lt;ActivityManager.AppTask&gt; getAppTasks() &#123;</span><br><span class="line">    ArrayList&lt;AppTask&gt; tasks = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;AppTask&gt;();</span><br><span class="line">    List&lt;IBinder&gt; appTasks;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        appTasks = getTaskService().getAppTasks(mContext.getOpPackageName());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> e.rethrowFromSystemServer();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">numAppTasks</span> <span class="operator">=</span> appTasks.size();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; numAppTasks; i++) &#123;</span><br><span class="line">        tasks.add(<span class="keyword">new</span> <span class="title class_">AppTask</span>(IAppTask.Stub.asInterface(appTasks.get(i))));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tasks;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>添加任务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/*  Add a new ActivityManager.AppTask for the calling application. This will create a new recents entry that is added to the end of all existing recents.</span></span><br><span class="line"><span class="comment">Params:</span></span><br><span class="line"><span class="comment">activity – The activity that is adding the entry. This is used to help determine the context that the new recents entry will be in.</span></span><br><span class="line"><span class="comment">intent – The Intent that describes the recents entry. This is the same Intent that you would have used to launch the activity for it. In generally you will want to set both Intent.FLAG_ACTIVITY_NEW_DOCUMENT and Intent.FLAG_ACTIVITY_RETAIN_IN_RECENTS; the latter is required since this recents entry will exist without an activity, so it doesn&#x27;t make sense to not retain it when its activity disappears. The given Intent here also must have an explicit ComponentName set on it.</span></span><br><span class="line"><span class="comment">description – Optional additional description information.</span></span><br><span class="line"><span class="comment">thumbnail – Thumbnail to use for the recents entry. Should be the size given by getAppTaskThumbnailSize(). If the bitmap is not that exact size, it will be recreated in your process, probably in a way you don&#x27;t like, before the recents entry is added.</span></span><br><span class="line"><span class="comment">Returns:</span></span><br><span class="line"><span class="comment">Returns the task id of the newly added app task, or -1 if the add failed. The most likely cause of failure is that there is no more room for more tasks for your app.*/</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">addAppTask</span><span class="params">(<span class="meta">@NonNull</span> Activity activity, <span class="meta">@NonNull</span> Intent intent,</span></span><br><span class="line"><span class="params">            <span class="meta">@Nullable</span> TaskDescription description, <span class="meta">@NonNull</span> Bitmap thumbnail)</span> </span><br></pre></td></tr></table></figure>


</li>
<li><p>移动任务</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public void moveTaskToFront(int taskId, @MoveTaskFlags int flags) &#123;</span><br><span class="line">    moveTaskToFront(taskId, flags, null);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><b><font color="#dd0000">服务相关</font></b></p>
<ul>
<li>获取运行时服务</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;RunningServiceInfo&gt; <span class="title function_">getRunningServices</span><span class="params">(<span class="type">int</span> maxNum)</span></span><br><span class="line">        <span class="keyword">throws</span> SecurityException &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getService()</span><br><span class="line">                .getServices(maxNum, <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> e.rethrowFromSystemServer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><b><font color="#dd0000">内存管理相关</font></b></p>
<p>定义了内部类MemoryInfo,主要属性如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MemoryInfo</span> <span class="keyword">implements</span> <span class="title class_">Parcelable</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The available memory on the system.  This number should not</span></span><br><span class="line"><span class="comment">     * be considered absolute: due to the nature of the kernel, a significant</span></span><br><span class="line"><span class="comment">     * portion of this memory is actually in use and needed for the overall</span></span><br><span class="line"><span class="comment">     * system to run well.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> availMem;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The total memory accessible by the kernel.  This is basically the</span></span><br><span class="line"><span class="comment">     * RAM size of the device, not including below-kernel fixed allocations</span></span><br><span class="line"><span class="comment">     * like DMA buffers, RAM for the baseband CPU, etc.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> totalMem;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The threshold of &#123;<span class="doctag">@link</span> #availMem&#125; at which we consider memory to be</span></span><br><span class="line"><span class="comment">     * low and start killing background services and other non-extraneous</span></span><br><span class="line"><span class="comment">     * processes.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> threshold;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set to true if the system considers itself to currently be in a low</span></span><br><span class="line"><span class="comment">     * memory situation.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> lowMemory;</span><br><span class="line"> <span class="comment">//... ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因此可以获取内存相关的信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMemoryInfo</span><span class="params">(MemoryInfo outInfo)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        getService().getMemoryInfo(outInfo);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> e.rethrowFromSystemServer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><b><font color="#dd0000">进程异常状态监控</font></b></p>
<p>内部类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Information you can retrieve about any processes that are in an error condition.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ProcessErrorStateInfo</span> <span class="keyword">implements</span> <span class="title class_">Parcelable</span> &#123;</span><br><span class="line">          <span class="keyword">public</span> <span class="type">int</span> condition;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The process name in which the crash or error occurred.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String processName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The pid of this process; 0 if none</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> pid;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The kernel user-ID that has been assigned to this process;</span></span><br><span class="line"><span class="comment">     * currently this is not a unique ID (multiple applications can have</span></span><br><span class="line"><span class="comment">     * the same uid).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> uid;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The activity name associated with the error, if known.  May be null.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String tag;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A short message describing the error condition.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String shortMsg;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A long message describing the error condition.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String longMsg;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The stack trace where the error originated.  May be null.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String stackTrace;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * to be deprecated: This value will always be null.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] crashData = <span class="literal">null</span>;</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>可见其中的crashData是我们重点关注的数据</p>
<ul>
<li>调用方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;ProcessErrorStateInfo&gt; <span class="title function_">getProcessesInErrorState</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getService().getProcessesInErrorState();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> e.rethrowFromSystemServer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><b><font color="#dd0000">运行时进程相关</font></b></p>
<p>内部类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">RunningAppProcessInfo</span> <span class="keyword">implements</span> <span class="title class_">Parcelable</span> &#123;</span><br><span class="line">     <span class="keyword">public</span> String processName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The pid of this process; 0 if none</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> pid;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The user id of this process.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> uid;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * All packages that have been loaded into the process.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String pkgList[];</span><br><span class="line">   <span class="comment">//... ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><p>设置内存level</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">setProcessMemoryTrimLevel</span><span class="params">(String process, <span class="type">int</span> userId, <span class="type">int</span> level)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getService().setProcessMemoryTrimLevel(process, userId,</span><br><span class="line">                level);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> e.rethrowFromSystemServer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取运行时进程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;RunningAppProcessInfo&gt; <span class="title function_">getRunningAppProcesses</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getService().getRunningAppProcesses();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> e.rethrowFromSystemServer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取进程状态</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getUidProcessState</span><span class="params">(<span class="type">int</span> uid)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getService().getUidProcessState(uid, mContext.getOpPackageName());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> e.rethrowFromSystemServer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取进程状态信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Debug.MemoryInfo[] getProcessMemoryInfo(<span class="type">int</span>[] pids) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> getService().getProcessMemoryInfo(pids);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">          <span class="keyword">throw</span> e.rethrowFromSystemServer();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>杀死后台进程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">killBackgroundProcesses</span><span class="params">(String packageName)</span> &#123;</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         getService().killBackgroundProcesses(packageName,</span><br><span class="line">                 mContext.getUserId());</span><br><span class="line">     &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">         <span class="keyword">throw</span> e.rethrowFromSystemServer();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/15/Activity%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="东">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="东的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 东的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/15/Activity%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">Activity分析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-04-15 10:52:17 / 修改时间：14:07:36" itemprop="dateCreated datePublished" datetime="2023-04-15T10:52:17+08:00">2023-04-15</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Activity作为四大组件之一，其重要性不言而喻。但是之前对于Activity的了解也只是限于生命周期，启动流程等过程，比较零散，没有系统的整理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Activity</span> <span class="keyword">extends</span> <span class="title class_">ContextThemeWrapper</span></span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">LayoutInflater</span>.Factory2,</span><br><span class="line">        Window.Callback, KeyEvent.Callback,</span><br><span class="line">        OnCreateContextMenuListener, ComponentCallbacks2,</span><br><span class="line">        Window.OnWindowDismissedCallback,</span><br><span class="line">        AutofillManager.AutofillClient, ContentCaptureManager.ContentCaptureClient </span><br></pre></td></tr></table></figure>

<p>从继承和实现关系上看，Activity继承自ContextThemeWrapper，同时实现了以下几个接口，从接口名称上大致可以判断，Activity还要和View，Window，KeyEvent等进行交互。所以也不仅仅是限于生命周期管理这么简单。</p>
<p>下面是一些重要的属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Instrumentation mInstrumentation;</span><br><span class="line"><span class="keyword">private</span> IBinder mToken;</span><br><span class="line"><span class="keyword">private</span> IBinder mShareableActivityToken;</span><br><span class="line"><span class="keyword">private</span> Application mApplication;</span><br><span class="line"><span class="comment">/*package*/</span> Intent mIntent;</span><br><span class="line"><span class="keyword">private</span> ComponentName mComponent;</span><br><span class="line"><span class="comment">/*package*/</span> ActivityInfo mActivityInfo;</span><br><span class="line"><span class="comment">/*package*/</span> ActivityThread mMainThread;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ArrayList&lt;Application.ActivityLifecycleCallbacks&gt; mActivityLifecycleCallbacks =</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Application.ActivityLifecycleCallbacks&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Window mWindow;</span><br><span class="line"><span class="keyword">private</span> WindowManager mWindowManager;</span><br><span class="line"><span class="comment">/*package*/</span> <span class="type">View</span> <span class="variable">mDecor</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="type">Handler</span> <span class="variable">mHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Handler</span>();</span><br><span class="line"><span class="keyword">final</span> <span class="type">FragmentController</span> <span class="variable">mFragments</span> <span class="operator">=</span> FragmentController.createController(<span class="keyword">new</span> <span class="title class_">HostCallbacks</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Thread mUiThread;</span><br><span class="line"><span class="keyword">private</span> SplashScreen mSplashScreen;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到Activity很忙，跟它交互的对象有很多。一个个看</p>
<ul>
<li><p>mInstrumentation</p>
<p>在代码中搜索它的作用只不过是对Activity的一些生命周期操作进行转发，如</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startActivityForResult</span><span class="params">(<span class="meta">@RequiresPermission</span> Intent intent, <span class="type">int</span> requestCode,</span></span><br><span class="line"><span class="params">            <span class="meta">@Nullable</span> Bundle options)</span> &#123;</span><br><span class="line">           <span class="comment">//...</span></span><br><span class="line">                mInstrumentation.execStartActivity(</span><br><span class="line">                    <span class="built_in">this</span>, mMainThread.getApplicationThread(), mToken, <span class="built_in">this</span>,</span><br><span class="line">                    intent, requestCode, options);</span><br><span class="line">           <span class="comment">//...</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>



<p>它的初始化则是在attach方法中注入。attach其实就是负责完成了Activity中的属性的初始化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">attach</span><span class="params">(Context context, ActivityThread aThread,</span></span><br><span class="line"><span class="params">            Instrumentation instr, IBinder token, <span class="type">int</span> ident,</span></span><br><span class="line"><span class="params">            Application application, Intent intent, ActivityInfo info,</span></span><br><span class="line"><span class="params">            CharSequence title, Activity parent, String id,</span></span><br><span class="line"><span class="params">            NonConfigurationInstances lastNonConfigurationInstances,</span></span><br><span class="line"><span class="params">            Configuration config, String referrer, IVoiceInteractor voiceInteractor,</span></span><br><span class="line"><span class="params">            Window window, ActivityConfigCallback activityConfigCallback, IBinder assistToken,</span></span><br><span class="line"><span class="params">            IBinder shareableActivityToken)</span> &#123;</span><br><span class="line">        attachBaseContext(context);</span><br><span class="line"></span><br><span class="line">        mFragments.attachHost(<span class="literal">null</span> <span class="comment">/*parent*/</span>);</span><br><span class="line"></span><br><span class="line">        mWindow = <span class="keyword">new</span> <span class="title class_">PhoneWindow</span>(<span class="built_in">this</span>, window, activityConfigCallback);</span><br><span class="line">        mWindow.setWindowControllerCallback(mWindowControllerCallback);</span><br><span class="line">        mWindow.setCallback(<span class="built_in">this</span>);</span><br><span class="line">        mWindow.setOnWindowDismissedCallback(<span class="built_in">this</span>);</span><br><span class="line">        mWindow.getLayoutInflater().setPrivateFactory(<span class="built_in">this</span>);</span><br><span class="line">        </span><br><span class="line">        mUiThread = Thread.currentThread();</span><br><span class="line"></span><br><span class="line">        mMainThread = aThread;</span><br><span class="line">        mInstrumentation = instr;</span><br><span class="line">        mToken = token;</span><br><span class="line">        mAssistToken = assistToken;</span><br><span class="line">        mShareableActivityToken = shareableActivityToken;</span><br><span class="line">        mIdent = ident;</span><br><span class="line">        mApplication = application;</span><br><span class="line">        mIntent = intent;</span><br><span class="line">        mReferrer = referrer;</span><br><span class="line">        mComponent = intent.getComponent();</span><br><span class="line">        mActivityInfo = info;</span><br><span class="line">        mTitle = title;</span><br><span class="line">        mParent = parent;</span><br><span class="line">        mEmbeddedID = id;</span><br><span class="line">        mLastNonConfigurationInstances = lastNonConfigurationInstances;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">        mWindow.setWindowManager(</span><br><span class="line">                (WindowManager)context.getSystemService(Context.WINDOW_SERVICE),</span><br><span class="line">                mToken, mComponent.flattenToString(),</span><br><span class="line">                (info.flags &amp; ActivityInfo.FLAG_HARDWARE_ACCELERATED) != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (mParent != <span class="literal">null</span>) &#123;</span><br><span class="line">            mWindow.setContainer(mParent.getWindow());</span><br><span class="line">        &#125;</span><br><span class="line">        mWindowManager = mWindow.getWindowManager();</span><br><span class="line">        mCurrentConfig = config;</span><br><span class="line"></span><br><span class="line">        mWindow.setColorMode(info.colorMode);</span><br><span class="line">        mWindow.setPreferMinimalPostProcessing(</span><br><span class="line">                (info.flags &amp; ActivityInfo.FLAG_PREFER_MINIMAL_POST_PROCESSING) != <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        setAutofillOptions(application.getAutofillOptions());</span><br><span class="line">        setContentCaptureOptions(application.getContentCaptureOptions());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p>熟悉Activity启动的话就会知道Activity的attach方法是在ActivityThread的 performLaunchActivity中调用的，初始化的内容比较多，想说的就是除了mWindow和mUiThread实在本地new出来的，其他的都是外部注入的，因此外部注入的对象可以只分析在当前对象中的作用，完整的功能机制后面在做分析。</p>
</li>
<li><p>mToken</p>
<p>mToken是一个IBinder对象，Activity中没有调用其方法，只是把它作为一个参数传来传去，但是随便跟踪一个方法，然后找到mToken具体调用的地方，会发现，mToken其实是一个ActivityRecord 对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Token</span> <span class="keyword">extends</span> <span class="title class_">Binder</span> &#123;</span><br><span class="line">    <span class="meta">@NonNull</span> WeakReference&lt;ActivityRecord&gt; mActivityRef;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Token&#123;&quot;</span> + Integer.toHexString(System.identityHashCode(<span class="built_in">this</span>)) + <span class="string">&quot; &quot;</span></span><br><span class="line">                + mActivityRef.get() + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>持有ActivityRecord的弱引用，因此也可以说他其实是一个ActiviytRecord对象。</p>
</li>
<li><p>mShareableActivityToken</p>
<p>也是ActivityRecord中的一个属性，尚不清楚具体作用</p>
</li>
<li><p>mApplication</p>
<p>mApplication不用多说，获取应用程序相关的信息</p>
</li>
<li><p>mIntent</p>
<p>当前Activity相关的intent</p>
</li>
<li><p>mActivityInfo</p>
<p>ActivityInfo类型对象，跟Activity一一对应</p>
</li>
<li><p>mMainThread</p>
<p>ActivityThead类型，ActivityThead是应用程序的main thread，在Activity中调用了两个方法</p>
<p>  getApplicationThread ： 返回的是一个IBinder对象，用于跨进程通信</p>
</li>
</ul>
<p>​         sendActivityResult： 发送结果给Activity，onActivityResult会被调用</p>
<ul>
<li><p>mActivityLifecycleCallbacks</p>
<p>主要跟Lifecycler结合使用，在生命周期改变时调用dispatchActivityXXX来完成相关接口的分发</p>
</li>
<li><p>mWindow，mWindowManager</p>
<p>每个activity对应着一个窗口</p>
</li>
<li><p>mDecor</p>
<p>视图的根view</p>
</li>
<li><p>mFragments</p>
<p>生命周期变化时调用相关的Framgent方法，完成Fragment的生命周期调用</p>
</li>
<li><p>mUiThread</p>
<p>当前Activity的运行线程，用来做主线程判断</p>
</li>
<li><p>mSplashScreen</p>
<p>跟闪屏进行交互</p>
</li>
</ul>
<p>以上便是Actvity中的一些重要对象，Activity的行为都跟他们息息相关。从面相对象的角度思考，清楚了Activity的交互对象，那么Activity的行为大致也就了解了，比如跟instrumentaion交互管理activity的启动，跟winow交互管理对应的窗口，也可以同SplashScreen交互，或者管理Framgent的启动等。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/05/%E6%9D%82%E8%AE%B0%EF%BC%881%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="东">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="东的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 东的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/05/%E6%9D%82%E8%AE%B0%EF%BC%881%EF%BC%89/" class="post-title-link" itemprop="url">杂记（1）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-04-05 14:58:02" itemprop="dateCreated datePublished" datetime="2023-04-05T14:58:02+08:00">2023-04-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-02-25 20:18:19" itemprop="dateModified" datetime="2024-02-25T20:18:19+08:00">2024-02-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><em>不注重研究现状，不注重研究历史，不注重马克思列宁主义的应用，这些都是极坏的作风。</em></p>
<p>​																	                              出自《改造我们的学习》毛泽东 </p>
<p>了解过去，掌握规律，把握当下。无忧无虑的幻想总是轻松自在的，而面对现实的时候则总是耗费精力的，这也是为什么会感到疲惫。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">东</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
